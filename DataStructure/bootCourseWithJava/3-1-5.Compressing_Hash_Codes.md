## 해시 크기 최적화

### 들어가기 전에
해시 충돌을 방지하기 위해 해시 크기를 최적화하는 방법을 살펴보자.

### 학습 목표
해시 충돌을 이해하고 해시 크기를 최적화할 수 있다.

### 핵심 단어
- 해시 충돌
- 최적화

---
#### 해시 크기 최적화
hashCode 함수는 객체 한개를 받고 정수를 반환하는데 이 값은 음수일수도 있고, 양수일수도 있다. 나중에 배열의 인덱스로 사용하기 위해서는 이 정수가 필요한데, 이제 이 정수를 배열에 사용하기 위해 최적화를 해야한다.  
우선 최대한 문제점이 생기지 않도록 해야한다.  
문제점 중 하나는 해시 충돌이다. 이런 충돌을 최대한 피하기 위한 한가지 방법은 테이블의 크기를 최적화 하는 것이다.  
테이블의 크기를 최적화하는 한가지 방법은 테이블의 크기를 홀수로 설정하는 것이다. 홀수로 설정하면 % 연산자를 사용했을 때 결과가 더 다양하게 나올 수 있기 때문이다.  
다른 한가지 방법은 테이블의 크기를 소수로 설정하는 것이다. 이유는 마찬가지로 나머지가 더 다양한 숫자가 나오게 되기 때문이다.

해시 함수는  key값에서 정수값을 계산하는데, 이때 해시 테이블의 길이를 벗어나지 않기 위해서 테이블 길이로 해시 함수의 리턴값을 모듈러(% - 나머지값) 연산한다고 한다.  
예를 들어 테이블의 크기가 6이고 특정 해시 함수를 사용했을 때 2의 배수를 반환한다면 2, 4, 6, 8, 10... 해시 함수에서 반환되는데, 이를 해시 테이블 사이즈에 맞게 조정(모듈러 사용)하면 2, 4, 0, 2, 4, 0...으로 변한다.

| 0 | 1 | 2 | 3 | 4 | 5 |
|---|---|---|---|---|---|
|   |   | 2 |   | 4 |   |
| 6 |   | 8 |   | 10|   |
| 12|   | 14|   | 16|   |

0, 2, 4에 값이 계속 들어가기 때문에 충돌이 발생하기 쉬워보인다.  
그런데 테이블을 소수로 만들면 상대적으로 값이 균등하게 들어간다. 소수는 1과 자기 자신을 제외한 수의 배수가 될 수 밖에 없다. 그래서 배수가 나오는 경우의 수를 최대한 줄이면 충돌을 최대한 방지할 수 있게 되는 것이다.

| 0 | 1 | 2 | 3 | 4 |
|---|---|---|---|---|
|   | 6 | 2 | 8 | 4 |
| 10| 16| 12| 18| 14|
| 20| 26| 22| 28| 24|

마찬가지로 짝수보다 홀수로 테이블 사이즈를 설정하면 좋은 이유는 모든 짝수는 최소 공약수인 2를 공유하기 때문이다. 그에 비해 홀수는 최소 공약수를 공유하지 않는다. 그래서 짝수보다 홀수로 설정하는 것이 값이 좀 더 균등하게 들어갈 가능성이 높다.

> 참고
> https://halfmoonbearlog.tistory.com/73
